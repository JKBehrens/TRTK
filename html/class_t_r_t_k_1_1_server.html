<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Transformation and Registration Toolkit: TRTK::Server Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<script src="../mathjax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="namespace_t_r_t_k.html">TRTK</a>      </li>
      <li><a class="el" href="class_t_r_t_k_1_1_server.html">Server</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<h1>TRTK::Server Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="TRTK::Server" -->
<p>Simple TCP/IP server (one client at a time).  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_client_server_8hpp_source.html">ClientServer.hpp</a>&gt;</code></p>

<p><a href="class_t_r_t_k_1_1_server-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9d109027c58812155ff09960d172a423"></a><!-- doxytag: member="TRTK::Server::Server" ref="a9d109027c58812155ff09960d172a423" args="()" -->
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_r_t_k_1_1_server.html#a9d109027c58812155ff09960d172a423">Server</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs a <a class="el" href="class_t_r_t_k_1_1_server.html" title="Simple TCP/IP server (one client at a time).">Server</a> object. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a795ac1924056322ccb83f96bbafbb87e"></a><!-- doxytag: member="TRTK::Server::~Server" ref="a795ac1924056322ccb83f96bbafbb87e" args="()" -->
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_r_t_k_1_1_server.html#a795ac1924056322ccb83f96bbafbb87e">~Server</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroys a <a class="el" href="class_t_r_t_k_1_1_server.html" title="Simple TCP/IP server (one client at a time).">Server</a> object. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_r_t_k_1_1_server.html#ac730dd9c8d5b55804a7c9d668b745bdc">startServer</a> (short port)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the server.  <a href="#ac730dd9c8d5b55804a7c9d668b745bdc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ace7bb5ad402687d0971488290835bf00"></a><!-- doxytag: member="TRTK::Server::stopServer" ref="ace7bb5ad402687d0971488290835bf00" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_r_t_k_1_1_server.html#ace7bb5ad402687d0971488290835bf00">stopServer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the server. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual std::pair&lt; char *, size_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_r_t_k_1_1_server.html#a5867ba7226ec4fe27d19bca824ab9c68">handleRequest</a> (const char *received_data, size_t length)=0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles incoming requests.  <a href="#a5867ba7226ec4fe27d19bca824ab9c68"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_r_t_k_1_1_server.html#a640c36d16d7875b25ebc4fdd29cc7cb7">closeConnection</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Notify the server about the client's intention to close the connection.  <a href="#a640c36d16d7875b25ebc4fdd29cc7cb7"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Simple TCP/IP server (one client at a time). </p>
<p>This class allows creating a simple server by just deriving from it. The server is only able to handle a single client-server-connection at a time (i.e. after accepting a client connection it communicates only with this particular client until this client disconnects).</p>
<p>A client-request is handled by the <a class="el" href="class_t_r_t_k_1_1_server.html#a5867ba7226ec4fe27d19bca824ab9c68" title="Handles incoming requests.">handleRequest()</a> function which is declared <code>virtual</code> so that it can be reimplemented by the derived class. It is the only way to communicate with the client. Each client request is followed by the server's answer which is directly sent to the client. It is assumed that the server keeps track of its state.</p>
<p>In the case of a network error (transmission error, unexpectedly disconnected client, etc.) an exception of the type <a class="el" href="class_t_r_t_k_1_1_network_error.html">NetworkError</a> is thrown.</p>
<dl class="user"><dt><b>Example:</b></dt><dd></dd></dl>
<p>Server.cpp</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;cstdio&gt;</span>
<span class="preprocessor"> #include &lt;iostream&gt;</span>
<span class="preprocessor"> #include &lt;string&gt;</span>

<span class="preprocessor"> #include &lt;<a class="code" href="_client_server_8hpp.html" title="This file contains classes for simple client-server-communication.">TRTK/ClientServer.hpp</a>&gt;</span>

 <span class="keyword">const</span> <span class="keywordtype">int</span> PORT = 9734;

 <span class="keyword">class </span><a class="code" href="class_t_r_t_k_1_1_server.html#a9d109027c58812155ff09960d172a423" title="Constructs a Server object.">Server</a> : <span class="keyword">public</span> TRTK::<a class="code" href="class_t_r_t_k_1_1_server.html#a9d109027c58812155ff09960d172a423" title="Constructs a Server object.">Server</a>
 {
 <span class="keyword">public</span>:
     std::pair&lt;char *, size_t&gt; <a class="code" href="class_t_r_t_k_1_1_server.html#a5867ba7226ec4fe27d19bca824ab9c68" title="Handles incoming requests.">handleRequest</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * data, <span class="keywordtype">size_t</span> size)
     {
         <span class="comment">// Put out the received data.</span>
         <span class="keywordflow">if</span> (size) std::cout &lt;&lt; data &lt;&lt; std::endl;

         <span class="comment">// Here the internal state can be changed or</span>
         <span class="comment">// the server can be shut down.</span>
         <a class="code" href="class_t_r_t_k_1_1_server.html#ace7bb5ad402687d0971488290835bf00" title="Stops the server.">stopServer</a>();

         <span class="comment">// Send the answer.</span>
         <span class="keywordtype">char</span> * str = <span class="keyword">new</span> <span class="keywordtype">char</span>[14];
         std::strcpy(str, <span class="stringliteral">&quot;Hello Client!&quot;</span>);
         <span class="keywordflow">return</span> std::pair&lt;char *, size_t&gt;(str, 14);
     }
 };

 <span class="keywordtype">int</span> main()
 {
     <span class="keywordflow">try</span>
     {
         <a class="code" href="class_t_r_t_k_1_1_server.html#a9d109027c58812155ff09960d172a423" title="Constructs a Server object.">Server</a> server;
         server.startServer(PORT);
     }
     <span class="keywordflow">catch</span> (std::exception &amp; error)
     {
         std::cout &lt;&lt; error.what() &lt;&lt; std::endl;
     }

     <span class="keywordflow">return</span> 0;
 }
</pre></div><p>Client.cpp</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;iostream&gt;</span>
<span class="preprocessor"> #include &lt;<a class="code" href="_client_server_8hpp.html" title="This file contains classes for simple client-server-communication.">TRTK/ClientServer.hpp</a>&gt;</span>

 <span class="keyword">const</span> <span class="keywordtype">char</span> HOSTNAME[] = <span class="stringliteral">&quot;127.0.0.1&quot;</span>; <span class="comment">// &quot;localhost&quot;;</span>
 <span class="keyword">const</span> <span class="keywordtype">int</span> PORT = 9734;

 <span class="keyword">class </span>Client : <span class="keyword">public</span> TRTK::Client
 {
 <span class="keyword">public</span>:
     Client() : reply((char *) NULL, 0)
     {
     }

     <span class="keywordtype">void</span> run()
     {
         connect(HOSTNAME, PORT);

         <span class="keywordtype">char</span> message[] = <span class="stringliteral">&quot;Hello server!&quot;</span>;
         reply = request(&amp;message[0], 14);
         <span class="keywordflow">if</span> (reply.second) std::cout &lt;&lt; reply.first &lt;&lt; std::endl;
         <span class="keyword">delete</span>[] reply.first;

         disconnect();
     }

 <span class="keyword">private</span>:
     std::pair&lt;char *, size_t&gt; reply;
 };

 <span class="keywordtype">int</span> main()
 {
     <span class="keywordflow">try</span>
     {
         Client client;
         client.run();
     }
     <span class="keywordflow">catch</span> (std::exception &amp; error)
     {
         std::cout &lt;&lt; error.what();
     }

     <span class="keywordflow">return</span> 0;
 }
</pre></div><p>Output:</p>
<p>Server.cpp</p>
<div class="fragment"><pre class="fragment">Hello server! </pre></div><p>Client.cpp</p>
<div class="fragment"><pre class="fragment">Hello client! </pre></div><dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="class_t_r_t_k_1_1_client.html" title="Simple TCP/IP client.">TRTK::Client</a></dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Christoph Haenisch </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>0.1.1 </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>last changed on 2014-07-05 </dd></dl>

<p>Definition at line <a class="el" href="_client_server_8hpp_source.html#l00214">214</a> of file <a class="el" href="_client_server_8hpp_source.html">ClientServer.hpp</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a640c36d16d7875b25ebc4fdd29cc7cb7"></a><!-- doxytag: member="TRTK::Server::closeConnection" ref="a640c36d16d7875b25ebc4fdd29cc7cb7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TRTK::Server::closeConnection </td>
          <td>(</td>
          <td class="paramname">&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Notify the server about the client's intention to close the connection. </p>
<p>Calling this function leads to the termination of the internal event loop regarding incoming client messages. This function could be called from the derived class (see <a class="el" href="class_t_r_t_k_1_1_server.html#a5867ba7226ec4fe27d19bca824ab9c68">handleRequest()</a>) if the client-server-dialog ends intentionally. </p>

<p>Definition at line <a class="el" href="_client_server_8cpp_source.html#l00414">414</a> of file <a class="el" href="_client_server_8cpp_source.html">ClientServer.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5867ba7226ec4fe27d19bca824ab9c68"></a><!-- doxytag: member="TRTK::Server::handleRequest" ref="a5867ba7226ec4fe27d19bca824ab9c68" args="(const char *received_data, size_t length)=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; char *, size_t &gt; TRTK::Server::handleRequest </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"> <em>received_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"> <em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles incoming requests. </p>
<p>This function is called, each time a client sends data to the server. The server responds by returning some data in the form of a <code>std::pair</code> consisting of a pointer to the block of data (on the heap) and its size. After having sent the data to the client the memory is freed using <code>delete</code>[]. </p>

</div>
</div>
<a class="anchor" id="ac730dd9c8d5b55804a7c9d668b745bdc"></a><!-- doxytag: member="TRTK::Server::startServer" ref="ac730dd9c8d5b55804a7c9d668b745bdc" args="(short port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TRTK::Server::startServer </td>
          <td>(</td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"> <em>port</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts the server. </p>
<p>The server will listen on port <code>port</code> and run in an infinite loop. If a client connects to the server the <code>virtual</code> method <a class="el" href="class_t_r_t_k_1_1_server.html#a5867ba7226ec4fe27d19bca824ab9c68" title="Handles incoming requests.">handleRequest()</a> is called and the received data is passed on. The data returned by this method is send to the client. </p>

<p>Definition at line <a class="el" href="_client_server_8cpp_source.html#l00465">465</a> of file <a class="el" href="_client_server_8cpp_source.html">ClientServer.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>D:/Users/haenisch/Programmierung/C++/TRTK/include/TRTK/<a class="el" href="_client_server_8hpp_source.html">ClientServer.hpp</a></li>
<li>D:/Users/haenisch/Programmierung/C++/TRTK/src/<a class="el" href="_client_server_8cpp_source.html">ClientServer.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/>
    <address class="footer">
        <small>
            Copyright 2010 - 2014 by Christoph Hänisch,
            Chair of Medical Engineering (mediTEC),
            RWTH Aachen University <p>
            Documentation generated by <a href="http://www.doxygen.org/index.html"> Doxygen </a>
        </small>
    </address>

</body>
</html>
